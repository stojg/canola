{
  "version": 3,
  "sources": ["/Users/stojg/Sites/canola/src/lib/lights.ts"],
  "sourcesContent": ["import type { vec3, vec4 } from 'gl-matrix'\nimport type REGL from 'regl'\n\ninterface Light {\n  on: boolean\n  color: vec3\n  pos: vec4\n}\n\nconst CUBE_MAP_SIZE = 512\n\nconst shadowConfig: REGL.FramebufferCubeOptions = {\n  radius: CUBE_MAP_SIZE,\n  colorFormat: 'rgba',\n  colorType: 'float',\n  stencil: false,\n}\n\nexport class Lights {\n  lights: Light[] = []\n  shadowFBOs: REGL.FramebufferCube[] = []\n\n  constructor() {}\n\n  add(on: boolean, color: vec3, pos: vec4) {\n    this.lights.push({ on: on, color: color, pos: pos })\n    this.shadowFBOs.push()\n  }\n\n  get(idx: number): Light {\n    return this.lights[idx]\n  }\n\n  shadowFBO(regl: REGL.Regl, id: number): REGL.FramebufferCube {\n    if (!(id in this.shadowFBOs)) {\n      this.shadowFBOs[id] = regl.framebufferCube(shadowConfig)\n    }\n    return this.shadowFBOs[id]\n  }\n\n  all(): Light[] {\n    return this.lights\n  }\n\n  lightUniform(regl: REGL.Regl, id: number): REGL.DrawConfig {\n    return {\n      uniforms: {\n        'light.on': this.lights[id].on,\n        'light.color': this.lights[id].color,\n        'light.position': this.lights[id].pos,\n      },\n    }\n  }\n\n  allUniforms(regl: REGL.Regl) {\n    return {\n      uniforms: this.luniforms(),\n    }\n  }\n\n  private luniforms(): LightUniforms {\n    const a: Record<string, any> = {}\n    this.lights.forEach((val: Light, idx: number) => {\n      a[`lights[${idx}].on`] = this.lights[idx].on\n      a[`lights[${idx}].color`] = this.lights[idx].color\n      a[`lights[${idx}].position`] = this.lights[idx].pos\n    })\n    return <LightUniforms>a\n  }\n}\n\ninterface LightUniforms {\n  'lights[0].on': boolean\n  'lights[0].color': vec3\n  'lights[0].position': vec4\n  'lights[1].on': boolean\n  'lights[1].color': vec3\n  'lights[1].position': vec4\n  'lights[2].on': boolean\n  'lights[2].color': vec3\n  'lights[2].position': vec4\n  'lights[3].on': boolean\n  'lights[3].color': vec3\n  'lights[3].position': vec4\n}\n"],
  "mappings": "AASA,MAAM,gBAAgB;AAEtB,qBAAkD;AAAA,EAChD,QAAQ;AAAA,EACR,aAAa;AAAA,EACb,WAAW;AAAA,EACX,SAAS;AAAA;AAfX;AAAA,EAsBE;AAHA,kBAAkB;AAClB,sBAAqC;AAAA;AAAA,EAIrC;AACE,SAAK,OAAO,KAAK,CAAE,IAAQ,OAAc;AACzC,SAAK,WAAW;AAAA;AAAA,EAGlB;AACE,WAAO,KAAK,OAAO;AAAA;AAAA,EAGrB;AACE,QAAI,CAAE,OAAM,KAAK;AACf,WAAK,WAAW,MAAM,KAAK,gBAAgB;AAAA;AAE7C,WAAO,KAAK,WAAW;AAAA;AAAA,EAGzB;AACE,WAAO,KAAK;AAAA;AAAA,EAGd;AACE,WAAO;AAAA,MACL,UAAU;AAAA,QACR,YAAY,KAAK,OAAO,IAAI;AAAA,QAC5B,eAAe,KAAK,OAAO,IAAI;AAAA,QAC/B,kBAAkB,KAAK,OAAO,IAAI;AAAA;AAAA;AAAA;AAAA,EAKxC;AACE,WAAO;AAAA,MACL,UAAU,KAAK;AAAA;AAAA;AAAA,EAIX;AACN,cAA+B;AAC/B,SAAK,OAAO,QAAQ;AAClB,QAAE,UAAU,aAAa,KAAK,OAAO,KAAK;AAC1C,QAAE,UAAU,gBAAgB,KAAK,OAAO,KAAK;AAC7C,QAAE,UAAU,mBAAmB,KAAK,OAAO,KAAK;AAAA;AAElD,WAAsB;AAAA;AAAA;",
  "names": []
}
