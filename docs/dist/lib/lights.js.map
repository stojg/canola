{
  "version": 3,
  "sources": ["/Users/stojg/Sites/canola/src/lib/lights.ts"],
  "sourcesContent": ["import type { vec4 } from 'gl-matrix'\nimport { vec3 } from 'gl-matrix'\nimport type REGL from 'regl'\n\ninterface Light {\n  on: boolean\n  color: vec3\n  pos: vec4\n  radius: number\n}\n\nconst CUBE_MAP_SIZE = 512\n\nconst black = vec3.create()\n\nexport class Lights {\n  lights: Light[] = []\n  shadowFBOs: REGL.FramebufferCube[] = []\n\n  constructor() {}\n\n  add(on: boolean, color: vec3, pos: vec4, radius: number) {\n    this.lights.push({ on: on, color: color, pos: pos, radius: radius })\n    this.shadowFBOs.push()\n  }\n\n  get(idx: number): Light {\n    return this.lights[idx]\n  }\n\n  shadowFBO(regl: REGL.Regl, id: number): REGL.FramebufferCube {\n    if (!(id in this.shadowFBOs)) {\n      this.shadowFBOs[id] = regl.framebufferCube({\n        radius: CUBE_MAP_SIZE,\n        colorType: 'half float',\n      })\n    }\n    return this.shadowFBOs[id]\n  }\n\n  all(): Light[] {\n    return this.lights\n  }\n\n  lightUniform(regl: REGL.Regl, idx: number): REGL.DrawConfig {\n    return {\n      uniforms: {\n        'light.color': this.lights[idx].on ? this.lights[idx].color : black,\n        'light.position': this.lights[idx].pos,\n        'light.radius': this.lights[idx].radius,\n      },\n    }\n  }\n\n  allUniforms(regl: REGL.Regl) {\n    return {\n      uniforms: this.luniforms(),\n    }\n  }\n\n  private luniforms(): LightUniforms {\n    const a: Record<string, any> = {}\n    this.lights.forEach((val: Light, idx: number) => {\n      a[`lights[${idx}].color`] = this.lights[idx].on ? this.lights[idx].color : black\n      a[`lights[${idx}].position`] = this.lights[idx].pos\n      a[`lights[${idx}].radius`] = this.lights[idx].radius\n    })\n    return <LightUniforms>a\n  }\n}\n\ninterface LightUniforms {\n  'lights[0].radius': number\n  'lights[0].color': vec3\n  'lights[0].position': vec4\n  'lights[1].radius': number\n  'lights[1].color': vec3\n  'lights[1].position': vec4\n  'lights[2].radius': number\n  'lights[2].color': vec3\n  'lights[2].position': vec4\n  'lights[3].radius': number\n  'lights[3].color': vec3\n  'lights[3].position': vec4\n}\n"],
  "mappings": "AACA;AAUA,MAAM,gBAAgB;AAEtB,cAAc,KAAK;AAbnB;AAAA,EAmBE;AAHA,kBAAkB;AAClB,sBAAqC;AAAA;AAAA,EAIrC;AACE,SAAK,OAAO,KAAK,CAAE,IAAQ,OAAc,KAAU;AACnD,SAAK,WAAW;AAAA;AAAA,EAGlB;AACE,WAAO,KAAK,OAAO;AAAA;AAAA,EAGrB;AACE,QAAI,CAAE,OAAM,KAAK;AACf,WAAK,WAAW,MAAM,KAAK,gBAAgB;AAAA,QACzC,QAAQ;AAAA,QACR,WAAW;AAAA;AAAA;AAGf,WAAO,KAAK,WAAW;AAAA;AAAA,EAGzB;AACE,WAAO,KAAK;AAAA;AAAA,EAGd;AACE,WAAO;AAAA,MACL,UAAU;AAAA,QACR,eAAe,KAAK,OAAO,KAAK,KAAK,KAAK,OAAO,KAAK,QAAQ;AAAA,QAC9D,kBAAkB,KAAK,OAAO,KAAK;AAAA,QACnC,gBAAgB,KAAK,OAAO,KAAK;AAAA;AAAA;AAAA;AAAA,EAKvC;AACE,WAAO;AAAA,MACL,UAAU,KAAK;AAAA;AAAA;AAAA,EAIX;AACN,cAA+B;AAC/B,SAAK,OAAO,QAAQ;AAClB,QAAE,UAAU,gBAAgB,KAAK,OAAO,KAAK,KAAK,KAAK,OAAO,KAAK,QAAQ;AAC3E,QAAE,UAAU,mBAAmB,KAAK,OAAO,KAAK;AAChD,QAAE,UAAU,iBAAiB,KAAK,OAAO,KAAK;AAAA;AAEhD,WAAsB;AAAA;AAAA;",
  "names": []
}
