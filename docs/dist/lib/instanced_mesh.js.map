{
  "version": 3,
  "sources": ["/Users/stojg/Sites/canola/src/lib/instanced_mesh.ts"],
  "sourcesContent": ["import type { Mesh } from './mesh'\nimport { Model } from './model'\nimport type REGL from 'regl'\nimport deepmerge from 'deepmerge'\n\nexport class InstancedMesh {\n  private mesh: Mesh\n  private models: Model[]\n  private readonly buffer: REGL.Buffer\n  private modelMeshConfig: REGL.DrawConfig<{}, {}, {}, {}, REGL.DefaultContext>\n\n  constructor(regl: REGL.Regl, mesh: Mesh, models: Model[]) {\n    this.mesh = mesh\n    this.models = models\n    this.buffer = regl.buffer({ data: [], type: 'float', length: models.length, usage: 'dynamic' })\n    this.modelMeshConfig = this.mesh.config(Model.config({}, this.buffer))\n    this._updateBuffer()\n  }\n\n  config(prev: {}) {\n    const inst = deepmerge(prev, { instances: this.models.length })\n    return deepmerge(inst, this.modelMeshConfig)\n  }\n\n  update() {\n    this.models.forEach((m) => m.update())\n    this._updateBuffer()\n  }\n\n  private _updateBuffer() {\n    const a: number[][] = []\n    this.models.forEach((l: Model) => {\n      a.push(l.bufferData)\n    })\n    this.buffer({ data: a })\n  }\n}\n"],
  "mappings": "AACA;AAEA;AAHA;AAAA,EAWE,YAAY;AACV,SAAK,OAAO;AACZ,SAAK,SAAS;AACd,SAAK,SAAS,KAAK,OAAO,CAAE,MAAM,IAAI,MAAM,SAAS,QAAQ,OAAO,QAAQ,OAAO;AACnF,SAAK,kBAAkB,KAAK,KAAK,OAAO,MAAM,OAAO,IAAI,KAAK;AAC9D,SAAK;AAAA;AAAA,EAGP;AACE,iBAAa,WAAU,MAAM,CAAE,WAAW,KAAK,OAAO;AACtD,WAAO,WAAU,MAAM,KAAK;AAAA;AAAA,EAG9B;AACE,SAAK,OAAO,QAAQ,OAAO,EAAE;AAC7B,SAAK;AAAA;AAAA,EAGC;AACN,cAAsB;AACtB,SAAK,OAAO,QAAQ;AAClB,QAAE,KAAK,EAAE;AAAA;AAEX,SAAK,OAAO,CAAE,MAAM;AAAA;AAAA;",
  "names": []
}
